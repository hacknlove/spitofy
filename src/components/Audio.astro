---
import { getEntry } from "astro:content";

const track =
  Astro.props.track || (await getEntry("tracks", "we will never die"));
---

<audio
  autoplay
  id="audioGlobal"
  crossorigin="anonymous"
  transition:name="audioGlobal"
  transition:persist
  data-bmp={track.data.bpm}
  preload="metadata"
  src={track.data.mp3}></audio>

<script>
  document.addEventListener("astro:page-load", () => {
    const audio = document.getElementById("audioGlobal") as HTMLMediaElement;

    if (!audio.paused) {
      document.body.classList.add("playing");
    }

    audio.addEventListener("ended", () => {
      document.body.classList.remove("playing");
    });
    audio.addEventListener("play", () => {
      document.body.classList.add("playing");
    });
    audio.addEventListener("pause", () => {
      document.body.classList.remove("playing");
    });
  });
</script>
