---
import "./Background.scss";
---

<div
  id="Background"
  class="container activeVisuals"
  style={{ display: "block" }}
>
  <div class="polygon">
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
    <div class="side"></div>
  </div>
</div>
<script src="./randomBackground.ts"></script>

<script>
  let lastFrame = 0;
  let audio;
  let background;

  function randomLogo(currentFrame: number) {
    if (!document.body.classList.contains("playing")) {
      window.requestAnimationFrame(randomLogo);
      return;
    }
    const bpm = audio.dataset.bmp || "120";

    let currentBpm = parseInt(bpm);

    if (currentFrame - lastFrame < 1000 / (currentBpm / 60) / 4) {
      window.requestAnimationFrame(randomLogo);
      return;
    }
    lastFrame = currentFrame;
    window.requestAnimationFrame(randomLogo);

    background.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, ${
      Math.random() * 25 + 25
    }%)`;
    background.style.perspective = `${Math.random() * 2 + 2}vmin`;
  }

  document.addEventListener("astro:page-load", () => {
    audio = document.getElementById("audioGlobal") as HTMLAudioElement;
    background = document.getElementById("Background") as HTMLElement;
  });

  setTimeout(() => {
    window.requestAnimationFrame(randomLogo);
  }, 5000);
</script>
